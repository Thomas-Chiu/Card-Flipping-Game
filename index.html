<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      html,
      body {
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: mediumaquamarine;
        overflow: hidden;
      }

      #game {
        width: 75%;
        display: flex;
        flex-wrap: wrap;
        justify-content: space-evenly;
      }

      .card {
        width: 12.5%;
        height: 180px;
        position: relative;
        transform-style: preserve-3d;
        /* transform: rotateY(180deg); */
        transition: transform 0.5s;
        float: left;
      }

      .front {
        width: 100%;
        height: 100%;
        position: absolute;
      }

      .back {
        width: 100%;
        height: 100%;
        background: url("./uno-card/back.png") no-repeat center/contain;
        position: absolute;
        transform: rotateY(180deg);
      }

      .open {
        transform: rotateY(0deg);
      }

      .block {
        background: url("./uno-card/block.png") no-repeat center/contain;
      }

      .switch {
        background: url("./uno-card/switch.png") no-repeat center/contain;
      }

      .plus2 {
        background: url("./uno-card/plus2.png") no-repeat center/contain;
      }

      .plus4 {
        background: url("./uno-card/plus4.png") no-repeat center/contain;
      }
    </style>
  </head>

  <body>
    <div id="game"></div>

    <script src="./js/jquery-3.5.0.min.js"></script>
    <script src="./js/sweetalert2.min.js"></script>
    <script>
      $(function () {
        // 洗牌function
        const shuffle = function () {
          for (let i = 0; i < $(`.card`).length; i++) {
            const refresh = Math.floor(Math.random() * $(`.card`).length);
            $(`.card`).eq(refresh).insertAfter($(`.card`).eq(i));
          }
        };

        let game = false;
        let input = "";

        // 放40 張牌
        for (let i = 0; i < 40; i++) {
          $(`#game`).append(`
                <div class="card">
                    <div class="front"></div>
                    <div class="back"></div>
                </div>
                `);
        }

        // 插入36 張uno 卡牌
        for (let i = 0; i < 4; i++) {
          for (let j = 0; j < 9; j++) {
            if (i == 0) {
              $(`.card`)
                .eq(j)
                .addClass(`${j + 1}`);
              $(`.card`)
                .eq(j)
                .find(`.front`)
                .css(
                  `background`,
                  `url(./uno-card/B${j + 1}.png) no-repeat center/contain`
                );
            }
            if (i == 1) {
              $(`.card`)
                .eq(j + 9)
                .addClass(`${j + 1}`);
              $(`.card`)
                .eq(j + 9)
                .find(`.front`)
                .css(
                  `background`,
                  `url(./uno-card/G${j + 1}.png) no-repeat center/contain`
                );
            }
            if (i == 2) {
              $(`.card`)
                .eq(j + 18)
                .addClass(`${j + 1}`);
              $(`.card`)
                .eq(j + 18)
                .find(`.front`)
                .css(
                  `background`,
                  `url(./uno-card/R${j + 1}.png) no-repeat center/contain`
                );
            }
            if (i == 3) {
              $(`.card`)
                .eq(j + 27)
                .addClass(`${j + 1}`);
              $(`.card`)
                .eq(j + 27)
                .find(`.front`)
                .css(
                  `background`,
                  `url(./uno-card/Y${j + 1}.png) no-repeat center/contain`
                );
            }
          }
        }

        // 插入4 張效果牌
        $(".card").eq(36).addClass("block");
        $(".card").eq(37).addClass("switch");
        $(".card").eq(38).addClass("plus2");
        $(".card").eq(39).addClass("plus4");

        // 開始翻牌
        $(`.card`).on(`click`, function () {
          if ($(`.open`).length < 2 && !$(this).hasClass(`open`)) {
            console.log(this);
            $(this).addClass(`open`);
          }

          if ($(`.open`).length == 2) {
            setTimeout(function () {
              $(`.open`).removeClass(`open`);

              // 跳sweetalert 給user 填答案
              // Swal.fire({
              //   title: "A x B = ",
              //   input: "text",
              //   inputValue: input,
              //   showCancelButton: false,
              //   inputValidator: (value) => {
              //     if (!value) {
              //       return "請輸入答案喔!";
              //     } else {
              //       input = value;
              //       console.log(input);
              //     }
              //   },
              // });
              shuffle();
            }, 1000);

            // 若兩張牌一樣
            for (let i = 0; i < 9; i++) {
              if (
                $(`.open`)
                  .eq(0)
                  .hasClass(i + 1) ===
                $(`.open`)
                  .eq(1)
                  .hasClass(i + 1)
              ) {
                $(`.open`).fadeTo(1000, 0).addClass(`ok`);
              }
            }
          }
        });
      });
    </script>
  </body>
</html>
